<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.19.3/xlsx.full.min.js"></script>
<input type="file" id="f" accept=".xlsx">
<script>
  document.getElementById('f').addEventListener('change', (e) => {
    const file = e.target.files[0];
    console.log('選択:', file?.name);
    if (!file) return;

    const r = new FileReader();
    r.onload = (ev) => {
      try {
        /* ← ここが核心！ ArrayBuffer そのまま渡す */
        const wb = XLSX.read(ev.target.result, {type: 'array'});
        console.log('SheetNames =', wb.SheetNames);   // ← ここが出れば成功
      } catch (err) {
        console.error('解析失敗', err);               // ← 失敗時の詳細
      }
    };
    r.onerror = (err) => console.error('FileReader エラー', err);
    r.readAsArrayBuffer(file);
  });
</script>
